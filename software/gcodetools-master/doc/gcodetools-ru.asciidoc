Gcodetools руководство пользователя
===================================
:Author:    Drobchenko Nickolay (Nick at forum http://www.cnc-club.ru), _taras_ (_taras_ at forum http://www.cnc-club.ru)
:Date:      11.07.2011
:Revision:  0001

== Благодарности 

=== Разработчики


* Николай Дробченко (Nick http://www.cnc-club.ru ) 
* Владимир Каляев (Dormouse http://www.cnc-club.ru ) 
* Henry Nicolas (Alfcnc http://www.cnc-club.ru ) 
* Chris Lusby Taylor (ChrisInNewbury http://www.cnc-club.ru ) 

=== Переводчики 


* John Brooker (greybeard из http://www.cnczone.com )


[TIP]
===============================
	.Примечание
		+gcodetools+ - выделяет названия программных продуктов.  
		*Жирное начертание* - клавиатурные команды 
		_Курсив_ - название операции (функции) в меню
===============================

== Описание программы Gcodetools

+Gcodetools+ это расширение для графического векторного редактора +Inkscape+ для создания G-кода на основе изображения. 
+Gcodetools+ умеет генерировать G-код для различных видов обработки - фрезерование 2.5D, токарная обработка, раскрой материала и др.

+Gcodetools+ и +Inkscape+ распространяются под лицензией GNU GPL, т.е. бесплатно, в т.ч. для коммерческого использования. Обе программы кросплатформенные, есть дистрибутивы под Windows, Linux и MacOS.

== Установка Gcodetools


=== Windows
Распакуйте архив и скопируйте все файлы в каталог _Program Files\Inkscape\share\extensions\_

=== Linux
Распакуйте архив и скопируйте все файлы в каталог _/home/<имя пользователя>/.config/inkscape/extensions/_ или _/usr/share/inkscape/extensions/_ и перезапустите inkscape 

Версию, находящуюся в разработке, можно  загрузить с http://www.launchpad.net/gcodetools при помощи bazaar, для этого выполните в консоли +bzr branch lp:gcodetools+ или через веб-интерфейс http://bazaar.launchpad.net/~gcodetools.team/gcodetools/develope/files.

== Возможности Gcodetools

* Экспорт в Gcode 
** Экспорт кривых в Gcode 
** Аппроксимация с использованием круговой интерполяции (G02 и G03) 
** Автоматическое разбиение кривых для достижения заданной степени точности 
** Обработка со сменой инструментов 
** Экспорт Gкода в параметрической или обычной формах 
** Добавление собственных заголовков и окончаний 
** Выбор единиц измерения 
** Многопроходная обработка 
** Автоматическое добавление цифрового суфикса к назваию сохраняемого файла 
* Обработка на токарном станке 
** Создание траекторий для обработки детали на токарном станке 
** Расчет чистового прохода 
** Задание заглубления при чистовом проходе 
*g Задание количества чистовых проходов 
** Два различных метода вычисления чистовых проходов 
** Замена стандартных осей 
* Обработка площади контуров 
** Создание траекторий для обработки площади контуров 
** Возможность коррекции созданных траекторий 
* Гравировка фигурными фрезами 
** Создание траекторий для обработки контуров фигурной фрезой 
** Задание произвольной формы фрезы 
* Библиотека инструментов 
** Здание различных параметров инструмента и обработки (диаметр инструмента, скорость обработки, заглубление за проход, скорость заглубления, задание произвольного кода перед/после заглубления, форма инструмента, произвольный код смены инструмента) 
** Возможность копирования инструментов 
** Возможность обработки со сменой инструмента 
* Система ориентирования 
** Задание масштабирования по всем осям 
** Задание поворотов в плоскости ХY 
** Задание смещения по всем осям 
** Ориентация по произвольным точкам 
* Постпроцессор 
** Создание произвольной программы постпроцессора или выбор из стандартного набора 
** Масштабирование и смещение Gcode 
** Произвольная замена команд (в том числе одновременная замена) 
** Параметризация Gcode 
** Округление длинны дробной части чисел в Gкоде 
* Предварительная проверка рисунка 
** Выделение маленьких контуров (возможных артефактов area) 
** Проверка принадлежности инструментов 
** Проверка порядка обработки 
* Плоттерная резка 
** Экспорт в Gкод для плоттера с тангенциальным ножом. Четвертая ось A - угол наклона ножа. 
* Общие 
** Проверка наличия обновлений.

== Основные понятия

=== Контур

+Gcodetools+ работает с кривыми безье - основным элеметном рисукнов в +Inkscape+. Все векторные объекты (фигуры, тексты, клоны) могут быть приведены к виду кривой Безье без потери точности. Для перевода объекта в кривую Безье (далее контур или path) нужно выполнить Контур-Оконтурить объект или нажать клавиши *Ctrl+Shift+C*.

=== Объект 

Объекты не являющиеся контурами, т.е. те объекты, которые нужно преобразовывать в контуры:

* Текст
* Фигуры: Окружности, эллипсы, прямоугольники, звезды, многоугольники
* Динамические втяжки

Чтобы определить, является ли объект контуром, нужно его выделить при этом в строке состояния должно быть написано Контур или несколько Контуров. 

=== Размер объекта

По-умолчанию, +Inkscape+ рассчитывает размер объектов исходя из его видимых размеров. Т.е. в линейные размеры объектов, помимо размеров контура, входят толщина обводки, размеры эффектов. Если вы нарисуете круг размером 10х10мм с обводкой 1мм, то +Inkscape+ будет отображать его размер как 11х11мм, но при экспорте в G-код круг будет диаметром 10мм. Это связанно с тем, что основное предназначение +Inkscape+ - векторная графика. 

Чтобы +Inkscape+ отображал реальные размеры контуров без учета обводк и эффектов нужно зайти в настройки +Inkscape+ нажатием клавиш *Ctrl+Shift+P*, в самом верхнем пункте (_Инструменты_) изменить _Площадка объекта_ на _Геометрическая площадка_.

Единицы измерения -  по умолчанию +Inkscape+ используется - px (пикселы). Соотношения между пискселами и другими единицами измерения 

* 1 дюйм = 90 px = 25.4 мм
* 1 мм = 3.543 px ~ 0.03937 дюйма
* 1 px = 0.2822 мм ~ 0.01111 дюйма


Практически все внутренние вычисления проводятся в px. Единицы измерения можно изменить в настройках документа нажатием клавиш *Ctrl+Shift+D*. Можно настроить единицы отображения, единицы линеек и единицы сетки.


== Интерфейс Gcodetools 

=== Вкладки

Т.к. +Gcodetools+ является стандартным расширением +Inkscape+, то возможности по созданию интерфейсов сильно ограничены. Выбор выполняемой функции определяется открытой вкладкой во время нажатия кнопки _Применить_. Например, если Вы хотите выполнить экспорт в G-код, то перед нажатием на _Применить_ нужно открыть вкладку _Path to Gcode_. Если появляется следующая ошибка: 

[WARNING]
===============================
	Select one of the action tabs - Path to Gcode, Area, Engraving, DXF points, Orientation, Offset, Lathe or Tools library. 
	
	Current active tab id is "preferences"
===============================

то это значит, что вы не открыли нужную вкладку перед нажатием Применить. 

Раньше все вкладки +Gcodetools+ были размещены на одном окне, но вкладок становилось все больше и больше и они перестали влезать на экран, поэтому пришлось разместить их на разных окнах. При этом одни и те же вкладки могут встречаться на нескольких окнах по мере надобности.

=== Live preview

_Live preview_ - никогда не включайте Live preview. Чтобы окно +Gcodetools+ не блокировало +Inkscape+ и не закрывалось при нажатии Применить, +Gcodetools+ сделан в виде live effect. Это обусловливает появление _Live Preview_. Но с live preview могут возникать проблемы, поэтому, лучше не трогайте _live preview_!

=== Дополнительные настройки

Некоторые настройки, такие как параметры инструментов и точки ориентации, вынесены с формы +Gcodetools+ в сам рисунок. В этом случае их можно редактировать при помощи инструмента _Текст_ (*F8*). Например, чтобы изменить подачу включите инструмент Текст и измените число напротив поля Feed в описании инструмента. Старайтесь редактировать такие параметры только при помощи инструмента _Текст_. Такие настройки, например определение инструментов можно копировать обычными методами +Inkscape+.

[IMPORTANT]
===============================
	Ни в коем случае не разгруппировывайте группы настроек, это удалит скрытые параметры и +Gcodetools+ не сможет определить эти настройки!
===============================

== Вкладка  Path to Gcode

image:img/path-to-gcode-tab.png[]

Экспорт в G-код (_Path to Gcode_) - самая первая функция, с которой началась разработка +Gcodetools+. Она предназначена для экспорта контуров в Gcode для фрезерной обработки и раскроя материала. Режущий инструмент перемещается в плоскости XY повторяя выбранные контуры. 

_Path to Gcode_ использует Точки ориентации и характеристики Инструментов для определения параметров обработки (подача, скорость заглубления, заглубление за проход, дополнительный G-код перед/после контура (см. далее)). Если Точки ориентации или определение инструмента не были заданы, то +Gcodetools+ добавит стандартный инструмент и стандартные точки ориентации, о чем будет дополнительное сообщение.

_Path to Gcode_ это одна из основных функций и она будет использоваться на финальной стадии создания G-code практически для любого вида обработки.

По-умолчанию, _Path to Gcode_ экспортирует выделенные контуры в G-code, если ничего не выделено то _Path to Gcode_ попытается экспортировать все контуры на рисунке (это поведение можно изменить, отключив на вкладке _Options_ опцию _Select all paths if nothing selected_). 

=== Параметры Path to Gcode
 
_Biarc interpolation tolerance_ - допуск по точности аппроксимации контура биарками. Изначально каждый сегмент контура аппроксимируется одной биаркой, затем вычисляется максимальное расстояние от биарки до сегмента контура. Если оно превышает заданный допуск в единицах измерения (заданных точками ориентации) то сегмент разбивается на две части, и процедура повторяется для каждой части отдельно.

_Maximum splitting depth_ - максимальная глубина разбиения, максимально число итераций для аппроксимации сегмента контура биарками. Необходимо отметить, что конечное число частей. на которые будет разбит контур может быть гораздо больше, чем максимальная глубина разбиения. Оно ограниченно 2n, где n это максимальная глубина разбиения. Если необходимая точность достигнута на какой-то итерации, то сегмент контура не будет разбиваться далее. Если вы все-таки хотите, чтобы сегмент был разбит на максимальное количество частей, то просто установите допуск аппроксимации равным 0. 

_Cutting order_ - это порядок в котором будут обрабатываться контуры. Контуры обрабатываются в порядке следования Слоев на рисунке, сначала обрабатывается самый верхний слой, за тем слои которые находятся ниже. Внутри слоя очередность обработки может быть следующей: 

* _Path by path_ - обработка ведется контур за контуром. Т.е. сначала обрабатывается перый контур целиком, затем второй и т.д. Все контуры обрабатываются на максимальную глубину перед переходом к следующему контуру.
* _Subpath by Subpath_ - обработка субкотура за субконтуром. Тоже самое, что и _Path by path_, но на уровне субконтуров. Контуры могут состоять из нескольких субконтуров. Например, контур с отверстием это два субконтура - внешний и внутренний. Даже если в субконтуре нет отверстий и он кажется непрерывным он все рано может состоять из нескольких субконтуров. Для того, чтобы разделить субконтуры нужно нажать _Контур_ - _Разбить_ (*Ctrl+Shift+K*). Для того, чтобы объединить контуры в один контур - _Контур_ - _Объединить_ или *Ctrl+K*.
* _Pass by pass_ - проход за проходом. Сначала будут обработаны все контуры на заглубление первого прохода, потом на заглубление второго прохода и т. д.

_Depth function_ - при помощи этой функции можно дополнительно определить глубину обработки. При задании _Depth function_ можно пользоваться математическими и другими фцнкциями python (например math.sin(), math.sqrt()). Также могут быть определены константы:

* d - глубина обработки заданная при помощи точек ориентации
* s - координата поверхности заданная при помощи точек ориентации
* c - коэффициент цвета. Число от 0 до 1 определяющее яркость цвета контура (0.0 - белый, 1.0 - черный). 

_Sort paths to reduse rapid distance_ - сортировать контуры для того, чтобы уменьшить холостой пробег.


== Вкладка Параметры

image:img/parameters-tab.png[]

_Select all paths if nothing selected -_ если ни один контур не выбран и включена эта опция, то +Gcodetools+ будет пытаться обработать все контуры на рисунке. 

_Minimun arc radius_ - EMC2 может выдать ошибку если радиус дуги G02 или G03 будет меньше 0.02 мм (также возможны ошибки в других контроллерах на маленьких дугах). Поэтому все дуги с радиусом меньше _Minimun arc radius_ будут заменяться прямыми отрезками G01.

_Get additional comments from objects properties_ - +gcodetools+ может извлекать дополнительные параметры объектов из их свойств. Эти параметры можно отредактировать нажав правой кнопкой мышки на объекте и выбрав _Свойства_.

_Comment Gcode_ - В этом поле можно задавать дополнительные коментарии которые будут отображаться перед началом обработки контура.

== Вкладка Preferences

image:img/preferences-tab.png[]

_File_ - название файла для сохранения готового G-кода. 

_Add numeric suffix to filename_ - если включена, к имени файла будет автоматически добавляться числовой суффикс для предотвращения перезаписи старых экспортов, например output.ngc -> output_0001.ngc.

_Directory_ - папка в которую будет сохраняться G-код. Удостоверьтесь, что у вас есть права на запись в этой папку, в противном случае +Gcodetools+ выдаст ошибку. Если в этой директории содержаться файлы header или footer, то они будут использованы в качестве заголовка и окончания G-кода вместо стандартных заголовков.

_Z safe distance for G00 move over blanc_ - безопасная дистанция над поверхностью материала на которой будут выполняться перемещения от контура к контуру. Выставляйте это расстояние больше всех элементов крепления заготовки, для того, чтобы быть уверенным в том, что вы не врежетесь в них инструментом. 

_Units_ - единицы измерения мм или дюймы определяет постановку кода G20 или G21 в готовый G-код.

_Post processor_ - заранее заданные пост процессоры для дополнительной подготовки Gcode.

_Additional post processor_ - вы можете задать произвольный пост-процессор. Подробнее о возможностях и синтаксисе пост-процессоров смотрите по ссылке: http://cnc-club.ru/forum/viewtopic.php?f=33&t=78 (пока только на английском).

_Generate log file_ - генерировать файл лога. 

_Full path to log file_ - полный путь к лог файлу. 
	


== Вкладка Area

image:img/area-tab.png[]
	
При помощи вкладки _Area_ можно создавать контуры для обработки площадей. _Area_ использует внутренние функции +Inkscape+ для создания контуров, а именно _Dynamic offset_ (динамическая втяжка). После применения _Area_ в рисунок будет добавлено необходимое количество динамических втяжек. Функция _Area_ дает не самые лучшие результаты по качеству выборки материала. Если обработка ведется без нахлеста траекторий, то в острых углах будут оставаться необработанные участки.

_Maximum area cutting curves_ - этот параметр нужен для того, чтобы избежать слишком большого количества динамических втяжек.

_Area width_ - это онсновной параметр, от которого зависит количество добавленных контуров. Количество контуров равно Area width/Tool D (ширина контура/диаметр инструмента). Ширина контура это не ширна в общем смысле, это толщина в самом толстом месте.

_Area tool overlap_ - параметр задающий нахлест траекторий. Это может быть необходимо для получения более чистого результата. 0.0 - означает без нахлеста, 0.9 - практически полный нахлест.


== Вкладка Fill area

image:img/fill-area-tab.png[]

_Fill_ _area_ - функция служит для заполнения площади контура прямыми линиями. Заполнять можно по двум алгоритмам - зигзаг и спираль. Эта функция самая стабильная из всех функций по обработке площади, т.к. не требует сложных вычислений.

_Area fill angle_ - угол наклона прямых. 0 - вертикальные линии.

_Area fill shift_ - сдвиг "фазы" заполнения линиями (от 0 до 1).

_Area fill overlap_ - нахлест траекторий. Нужен для получения более качественной обработки и более простого съема материала. (0 - без нахлеста, 0.9 - практически полный нахлест)

_Filling method_ - выбор метода заполнения - зигзаг или спираль.



== Вкладка Area artifacts

image:img/aria-artifacts-tab.png[]

_Area artefacts_ Т.к. функция отступа кривой безье очень не простая, иногда она дает артефакты. А при увеличении количества отступов вероятность появления ошибок растет. Для поиска этих ошибок разработана функция _Area artefacts_. Она ищет контуры маленького размера и в зависимости от выбранного действия выделяет их цветом или стрелкой или удаляет.

_Aretefact diametr_ - максимальный размер артефакта, все контуры меньше заданного размера будут выделены\удалены.

_Action_ - действие производимое с артефактами. Выделить цветом, выделить стрелкой, удалить.




== Вкладка Orientation points

image:img/orientation-points-tab.png[]

_Orientation_ _points_ (точки ориентации) нужны для позиционирования материала детали на станке/рисунке. При помощи точек ориентации можно задать масштаб, перемещение, поворот, растяжение по осям.

Если необходима только простая ориентация без не пропорциональных растяжений по осям и отражений, используйте ориентацию по двум точкам.

После применения _Orientation_ _points_ на рисунок добавятся две или три точки ориентации. Точка ориентации это стрелка с координатами. Положение точки определяется исходя из положения вершины стрелки.

При помощи точек ориентирования можно ориентировать деталь по конкретным точкам, для этого выберите любые две или три точки на детали, переместите в них точки ориентации и задайте для них желаемые координаты.

В самом простом случае, точки ориентации просто добавляются в рисунок и задают начало координат.

Точки ориентации применяются к текущему слою и все слоям ниже (до следующего слоя имеющего свои точки ориентации).

IMPORTANT: Внимание! Не разгруппировывайте точки ориентации! Это приведет к их дисфункции! Для того, чтобы переместить только одну точку просто войдите в группу двойным щелчком мыши на группе. Координаты можно редактировать при помощи инструмента _Text_ (*F8*) не разгрупповывая элементы.

_Orientation type_ - ориентация по двум или трем точкам.

_Z surface_ - высота (координата Z) поверхности материала (начало обработки)

_Z depth_ - глубина (координата Z) обработки.

_Units _- единицы измерения, для удобства стандартные точки ориентации добавляются в точках (0,0), (0,100) и (100,0) для миллиметров и (0,0), (0,5) и (5,0) для дюймов.



== Вкладка Tools library

image:img/tools-library-tab.png[]

_Tools library_ (библиотека инструментов). Библиотека инструментов создает шаблон для описания конкретного типа инструментов.

В описании инструмента можно задавать различные параметры, начиная с простых, таких как диаметр, скорость реза, заглубление за проход, и оканчивая более сложными - G-код до и после контура, которые позволяют задавать, например, коды включения или выключения шпинделя или другого режущего интсрумента.


== Проверка обработки

Для того, чтобы увидеть, что будет реально вырезано, можно воспользоваться +Inkscape+ и не использовать внешние инструменты. Для этого:

* Выберите все контуры, которые будут экспортироваться или контуры предварительного просмотра
* Назначьте им толщину обводки равную толщине обрабатывающего инструмента
* Выберите скругление на углах контуров и скругление обводки на концах контура, во вкладке _Стиль обводки_ на окне _Заливка_ и _Обводка_
* Таким образом обводка будет изображать профиль фрезы на всей траектории реза.



== Пошаговое руководство по созданию G-кода обработки площади детали 

Такая обработка может понадобится, когда рисунок или деталь находится над (или под) основным массивом материала.

. Создаем, или загружаем нужные контуры. 
+
image:img/area-tutorial-0001.png[]

. Разгруппировываем, если в рисунке есть группы (*Ctrl+Shift+G*).
. Объединяем контуры используя булево сложение (*Ctrl+«+»*).
. Создаем прямоугольник, который будет ограничивать область картинки, помещаем его на задний план (*PageDown* или *End*).
. Выделяем все и применяем логическую операцию вычитания (*Ctrl+«-»*). В результате должны получить один контур, изображающий ту часть, которая должна быть обработана.
. Добавляем точки ориентации (не обязательный шаг, точки ориентации для мм добавятся автоматически, если они не были созданы заранее). _Расширения – Gcodetools – Orientation points_ (см. главу "Вкладка Orientation points" данного руководства). Выставляем глубину фрезерования и другие параметры, жмем «Применить», «Закрыть». Полученные точки начала координат будут в левом нижнем углу листа, перетаскиваем их (не разгруппировывая) в необходимую позицию относительно рисунка (к примеру, в левый нижний угол). (Вместо перемещения точек ориентации можно переместить сам рисунок.)
+
image:img/area-tutorial-0002.png[]

. Добавляем описание инструмента. _Расширения – Gcodetools – Tools library_ (см. главу "Вкладка Tools library" данного руководства), выбираем тип инструмента и жмем «Применить», «Закрыть». В изображение будет добаленно описание инструмента, основные параметры:
	* id — порядковый номер и название инструмента
	* diametr — диаметр режущей части инструмента
	* feed — скорость подачи
	* penetration angle - угол заглубления (пока не реализован!)
	* penetration feed - скорость заглубления (подача при заглублении фрезы)
	* depth step - заглубление на каждый проход обработки
	* tool change gcode - Gкод для смены инструмента
+
image:img/area-tutorial-0003.png[]

. Выделяем контур, и выполняем _Расширения – Gcodetools – Area_ (см. главу "Вкладка Area" данного руководства), выставляем количество кривых и ширину обрабатываемой площади по контуру, жмем «Применить», «Закрыть». Расширение добавляет в рисунок траектории инструмента.
+
image:img/area-tutorial-0004.png[]

. Разгруппировываем полученный объект (*Ctrl+Shift+G*). Удаляем оригинальный рисунок.
+
image:img/area-tutorial-0005.png[]

. Преобразовываем все оставшиеся траектории в контуры (*Ctrl+Shift+C*), с помощью инструмента редактирования узлов (*F2*), устраняем артефакты и редактируем ошибочные участки. 
+
[TIP]
===============================
	Для поиска и удаления артефактов можно воспользоваться инструментом Area artifacts (см. главу "Вкладка Area artifacts" этого руководства).
===============================
+
image:img/area-tutorial-0006.png[]

. После удаления всех нежелательных участков траектории выполняем _Расширения – Gcodetools – Path to Gcode_ (см. главу "Вкладка Path to Gcode" данного руководства), на вкладке «Preferences» устанавливаем папку для выходных файлов, выбираем необходимый постпроцессор (например, «Parametrize Gcode» для возможности последующего перемещения или масштабирования (не применимо к обработки площади, без соответствующего изменения диаметра режущего инструмента) обработки).
. (Не обязательный шаг) На вкладке «Параметры» устанавливаем флажок «Select all paths if nothing is selected», задаем минимальный радиус дуги траектории. 
. (Не обязательный шаг) На вкладке «Path to Gcode» выставляем допуск интерполяции и глубину разбиения кривых, жмем «Применить», «Закрыть».
+
image:img/area-tutorial-0007.png[]

. В папке назначения будет создан файл с именем output_хххх.ngc, в котором будет содержаться Gкод для заданной обработки. Открываем файл в системе ЧПУ и проверяем полученную программу.
+
image:img/area-tutorial-0008.png[]


